name: CI-CD

on:
  push:
    branches: ["main"]
  workflow_dispatch:

jobs:
  ci:
    runs-on: ubuntu-latest
    steps:
      - name: Obter o código do projeto
        uses: actions/checkout@v4

<<<<<<< HEAD
     - name: Autenticar no Docker Hub
       uses: docker/login-action@v3
       with:
            username: ${{ secrets.DOCKERHUB_USERNAME }}
            password: ${{ secrets.DOCKERHUB_TOKEN }}
   
     - name: Construção e Envio da Imagem Docker
       uses: docker/build-push-action@v6
       with:
            context: ./src
            file: .src/Dockerfile
            tags:
               lfogaca34/fake-shop:latest
               lfogaca34/fake-shop:v${{github.run_number}}  
            push: true
            tags: user/app:latest
=======
      - name: Autenticar no Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}
>>>>>>> e1cfcaf7cd9da7a8190045cef8ccbd8b4787a94f

<<<<<<< HEAD
=======
      - name: Construção da Imagem Docker
        run: echo "Executando o comando Docker build"

      - name: Envio da Imagem Docker
        run: echo "Executando o comando Docker push"

>>>>>>> e1cfcaf7cd9da7a8190045cef8ccbd8b4787a94f
  cd:
    runs-on: ubuntu-latest
    needs: [ci]
    steps:
      - name: Autenticar na AWS
        run: echo "Executando o comando aws configure"

      - name: Configurar o kubectl
        run: echo "Executando o comando aws eks update-kubeconfig"

      - name: Deploy dos manifestos do Kubernetes
        run: echo "Executando o comando kubectl apply"

